{"version":3,"sources":["client/src/components/DataProvider.tsx","client/src/components/Layout.tsx","src/util.ts","src/block.ts","src/transaction.ts","client/src/components/Transaction.tsx","client/src/components/Block.tsx","client/src/components/BlockList.tsx","client/src/components/Wallet.tsx","client/src/components/MyWallet.tsx","client/src/utils/getJson.ts","client/src/components/miner.worker.ts","client/src/components/Mine.tsx","client/src/components/CreateTransaction.tsx","client/src/App.tsx","client/src/index.tsx"],"names":["GENESIS_BLOCK","previousHash","hash","timestamp","data","nonce","database","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","chainRef","ref","transactionsRef","DataContext","createContext","chain","unconfirmedTransactions","DataProvider","children","useState","setChain","setUnconfirmedTransactions","useEffect","on","snapshot","val","Object","values","value","useMemo","Provider","useStyles","makeStyles","theme","root","display","toolbar","paddingRight","toolbarIcon","alignItems","justifyContent","padding","mixins","appBar","zIndex","drawer","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","width","enteringScreen","menuButton","marginRight","menuButtonHidden","title","flexGrow","drawerPaper","position","whiteSpace","drawerPaperClose","overflowX","spacing","breakpoints","up","appBarSpacer","content","height","overflow","container","paddingTop","paddingBottom","paper","flexDirection","fixedHeight","Layout","classes","React","open","setOpen","history","useHistory","className","CssBaseline","AppBar","clsx","Toolbar","IconButton","edge","color","aria-label","onClick","Typography","component","variant","noWrap","Drawer","Divider","List","ListItem","button","push","ListItemIcon","ListItemText","primary","Container","maxWidth","Grid","crypto","require","getHash","createHash","update","digest","getHashBase","dataSerializer","calculateBlockHash","block","updateHash","createBlock","Date","now","getDifficultyForNextBlockFromTimestamps","timestamps","length","chunkLength","getNextChunk","remainingArray","collectedArrays","slice","reduce","difficulty","currentChunk","averageMiningTime","arr","averageDifference","DIFFICULTY_EXPECTED_MINING_TIME","Math","min","max","ec","ecdsa","transactionSerializer","transaction","inputs","map","input","signature","transactionId","transactionOutputIndex","join","outputs","output","address","amount","id","message","generateTransactionID","signTransactionInputs","secretKey","key","keyFromPrivate","byteArray","sign","toDER","Array","from","byte","toString","createTransactionForAmount","myPublicKey","targetPublicKey","myUnspentTransactionOutputs","requestedAmount","currentAmount","includedOutputs","i","leftoverAmount","Error","findUnspentOutputsForAmount","unspentTransactionsOfAddress","index","createUnsignedInputFromUnspentOutput","createOutputs","createCoinbaseTransaction","blockHeight","publicKey","createTransaction","unspentTransactions","newUnspentOutputs","acc","concat","createUnspentTransactionOutputs","allInputsOnThisBlock","filter","unspentTransaction","find","calculateUnspentOutputs","receiverPublicKey","getSenderAddress","sampleInput","outputTransactionBlock","outputTransaction","fontSize","shortAddress","substr","TransactionComponent","sender","useContext","senderDisplay","to","Card","CardContent","difficultyRegex","BlockComponent","exec","gutterBottom","toLocaleString","Accordion","AccordionSummary","expandIcon","aria-controls","AccordionDetails","item","xs","BlockList","reversedChain","reverse","lg","wordBreak","Wallet","useParams","balance","balanceOfAddress","transactions","console","log","getTransactionsOfAddress","Paper","Table","size","TableHead","TableRow","TableCell","align","TableBody","isCoinbase","Number","isInteger","o","a","senderAddress","isOutgoing","relevantOutput","otherAddress","otherAddressDisplay","MyWallet","localStorage","getItem","setPublicKey","secret","setSecret","setItem","TextField","label","onChange","event","target","margin","ROOT","post","path","body","fetch","method","JSON","stringify","mode","credentials","headers","then","res","json","Worker_fn","Worker","text","select","hashCount","setHashCount","setBlock","solutions","setSolutions","cores","setCores","workers","useRef","progressInfo","coinbaseTransaction","unminedBlock","getDifficultyForNextBlock","onWorkerEvent","useCallback","workerEvent","type","count","newWorkers","miner","Miner","postMessage","onmessage","current","forEach","worker","terminate","catch","err","handleCoresChange","hashRate","FormControl","Select","labelId","navigator","hardwareConcurrency","fill","_","MenuItem","floor","CreateTransaction","recipient","setData","handleRecipientChange","handleAmountChange","parseInt","signTransaction","send","Button","disabled","App","exact","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.fa167853.chunk.js","sourcesContent":["import React, { createContext, useEffect, useMemo, useState } from \"react\";\r\nimport { Block, Chain } from \"../../../src/block\";\r\nimport { Transaction } from \"../../../src/transaction\";\r\nimport firebase from 'firebase/app';\r\nimport 'firebase/database';\r\n\r\nconst GENESIS_BLOCK: Block<Transaction[]> = {\r\n  previousHash: '0',\r\n  hash: '71ce399acfbec8338142fe71828dbadd901cbc96c907d67ea61110dc08b272ae',\r\n  timestamp: 0,\r\n  data: [],\r\n  nonce: 1\r\n};\r\n\r\nconst firebaseApp = firebase.initializeApp({\r\n  apiKey: \"AIzaSyCRBU7LClPN4lRzI1GnwPPo_grSmScxwbg\",\r\n  authDomain: \"hyggecoin.firebaseapp.com\",\r\n  databaseURL: \"https://hyggecoin-default-rtdb.europe-west1.firebasedatabase.app\",\r\n  projectId: \"hyggecoin\",\r\n  storageBucket: \"hyggecoin.appspot.com\",\r\n  messagingSenderId: \"634436645550\",\r\n  appId: \"1:634436645550:web:9d685b017f569b207e733f\"\r\n});\r\n\r\nconst database = firebaseApp.database();\r\n\r\nconst chainRef = database.ref('/chain');\r\nconst transactionsRef = database.ref('/transactions');\r\n\r\nconst DataContext = createContext<{\r\n  chain: Chain<Transaction[]>,\r\n  unconfirmedTransactions: Transaction[] | null\r\n}>({\r\n  chain: [],\r\n  unconfirmedTransactions: null\r\n});\r\n\r\nexport default function DataProvider({ children }: { children: React.ReactElement}): React.ReactElement {\r\n\r\n  const [chain, setChain] = useState<Chain<Transaction[]>>([]);\r\n  const [unconfirmedTransactions, setUnconfirmedTransactions] = useState<Transaction[] | null>(null);\r\n\r\n  useEffect(() => {\r\n    chainRef.on('value', (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        setChain(Object.values(data));\r\n      } else {\r\n        setChain([]);\r\n      }\r\n    });\r\n\r\n    transactionsRef.on('value', (snapshot) => {\r\n      const data = snapshot.val();\r\n      if (data) {\r\n        setUnconfirmedTransactions(Object.values(data));\r\n      } else {\r\n        setUnconfirmedTransactions([]);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const value = useMemo(() => ({\r\n    chain: [GENESIS_BLOCK, ...chain],\r\n    unconfirmedTransactions\r\n  }), [chain, unconfirmedTransactions])\r\n\r\n  return (\r\n    <DataContext.Provider value={value}>\r\n      {children}\r\n    </DataContext.Provider>\r\n  );\r\n}\r\n\r\nexport {\r\n  DataContext\r\n};","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport List from '@material-ui/core/List';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Container from '@material-ui/core/Container';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport DashboardIcon from '@material-ui/icons/Dashboard';\r\nimport WalletIcon from '@material-ui/icons/AccountBalanceWallet';\r\nimport MemoryIcon from '@material-ui/icons/Memory';\r\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\nimport SwapHorizIcon from '@material-ui/icons/SwapHoriz';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport { useHistory } from 'react-router';\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex',\r\n  },\r\n  toolbar: {\r\n    paddingRight: 24, // keep right padding when drawer closed\r\n  },\r\n  toolbarIcon: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'flex-end',\r\n    padding: '0 8px',\r\n    ...theme.mixins.toolbar,\r\n  },\r\n  appBar: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n  appBarShift: {\r\n    marginLeft: drawerWidth,\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  menuButton: {\r\n    marginRight: 36,\r\n  },\r\n  menuButtonHidden: {\r\n    display: 'none',\r\n  },\r\n  title: {\r\n    flexGrow: 1,\r\n  },\r\n  drawerPaper: {\r\n    position: 'relative',\r\n    whiteSpace: 'nowrap',\r\n    width: drawerWidth,\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  drawerPaperClose: {\r\n    overflowX: 'hidden',\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    width: theme.spacing(7),\r\n    [theme.breakpoints.up('sm')]: {\r\n      width: theme.spacing(9),\r\n    },\r\n  },\r\n  appBarSpacer: theme.mixins.toolbar,\r\n  content: {\r\n    flexGrow: 1,\r\n    height: '100vh',\r\n    overflow: 'auto',\r\n  },\r\n  container: {\r\n    paddingTop: theme.spacing(4),\r\n    paddingBottom: theme.spacing(4),\r\n  },\r\n  paper: {\r\n    padding: theme.spacing(2),\r\n    display: 'flex',\r\n    overflow: 'auto',\r\n    flexDirection: 'column',\r\n  },\r\n  fixedHeight: {\r\n    height: 240,\r\n  },\r\n}));\r\n\r\nexport default function Layout({ children }: { children: React.ReactElement }) {\r\n  const classes = useStyles();\r\n  const [open, setOpen] = React.useState(true);\r\n  const handleDrawerOpen = () => {\r\n    setOpen(true);\r\n  };\r\n  const handleDrawerClose = () => {\r\n    setOpen(false);\r\n  };\r\n  const history = useHistory();\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <CssBaseline />\r\n      <AppBar position=\"absolute\" className={clsx(classes.appBar, open && classes.appBarShift)}>\r\n        <Toolbar className={classes.toolbar}>\r\n          <IconButton\r\n            edge=\"start\"\r\n            color=\"inherit\"\r\n            aria-label=\"open drawer\"\r\n            onClick={handleDrawerOpen}\r\n            className={clsx(classes.menuButton, open && classes.menuButtonHidden)}\r\n          >\r\n            <MenuIcon />\r\n          </IconButton>\r\n          <Typography component=\"h1\" variant=\"h6\" color=\"inherit\" noWrap className={classes.title}>\r\n            Hyggecoin\r\n          </Typography>\r\n        </Toolbar>\r\n      </AppBar>\r\n      <Drawer\r\n        variant=\"permanent\"\r\n        classes={{\r\n          paper: clsx(classes.drawerPaper, !open && classes.drawerPaperClose),\r\n        }}\r\n        open={open}\r\n      >\r\n        <div className={classes.toolbarIcon}>\r\n          <IconButton onClick={handleDrawerClose}>\r\n            <ChevronLeftIcon />\r\n          </IconButton>\r\n        </div>\r\n        <Divider />\r\n        <List>\r\n          <div>\r\n            <ListItem button onClick={() => history.push(\"/chain-explorer\")}>\r\n              <ListItemIcon>\r\n                <DashboardIcon />\r\n              </ListItemIcon>\r\n              <ListItemText primary=\"Chain Explorer\" />\r\n            </ListItem>\r\n            <ListItem button onClick={() => history.push(\"/wallet\")}>\r\n              <ListItemIcon>\r\n                <WalletIcon />\r\n              </ListItemIcon>\r\n              <ListItemText primary=\"My Wallet\" />\r\n            </ListItem>\r\n            <ListItem button onClick={() => history.push(\"/create-transaction\")}>\r\n              <ListItemIcon>\r\n                <SwapHorizIcon />\r\n              </ListItemIcon>\r\n              <ListItemText primary=\"Create Transaction\" />\r\n            </ListItem>\r\n            <ListItem button onClick={() => history.push(\"/mine\")}>\r\n              <ListItemIcon>\r\n                <MemoryIcon />\r\n              </ListItemIcon>\r\n              <ListItemText primary=\"Mine Coins\" />\r\n            </ListItem>\r\n          </div>\r\n        </List>\r\n      </Drawer>\r\n      <main className={classes.content}>\r\n        <div className={classes.appBarSpacer} />\r\n        <Container maxWidth=\"lg\" className={classes.container}>\r\n          <Grid container spacing={3}>\r\n            {children}\r\n          </Grid>\r\n        </Container>\r\n      </main>\r\n    </div>\r\n  );\r\n}","const crypto = require('crypto');\r\n\r\nexport function getHash(content: string): string {\r\n  const hash = crypto.createHash('sha256');\r\n  hash.update(content);\r\n  return hash.digest('hex');\r\n}\r\n\r\nexport function toHexString(byteArray: any[]): string {\r\n  return Array.from(byteArray, (byte: any) => {\r\n      return ('0' + (byte & 0xFF).toString(16)).slice(-2);\r\n  }).join('');\r\n};\r\n\r\n/**\r\n * Split an array into arrays of a fixed length\r\n * Leftover items are included in the last array of fewer than the given length items\r\n */\r\nexport function chunk<T>(arr: T[], chunkLength: number): T[][] {\r\n  function getNextChunk(remainingArray: T[], collectedArrays: T[][]): T[][] {\r\n    if (remainingArray.length < chunkLength) {\r\n      return [...collectedArrays, remainingArray]\r\n    }\r\n    return getNextChunk(remainingArray.slice(chunkLength), [...collectedArrays, remainingArray.slice(0, chunkLength)]);\r\n  }\r\n  return getNextChunk(arr, []);\r\n}\r\n\r\n/**\r\n * The average of the difference between items in an array\r\n */\r\nexport function averageDifference(arr: number[]): number {\r\n  return (arr[arr.length - 1] - arr[0]) / (arr.length - 1);\r\n}","import { averageDifference, chunk, getHash } from \"./util\";\r\n\r\n/**\r\n * A single block in a blockchain\r\n */\r\nexport type Block<T> = {\r\n  /**\r\n   * Reference to the previous block. Since the blockchain is basically a linked list, this is how we know they string together.\r\n   * Also included in the current block's hash, so that the chain can't be altered without altering all the rest of it\r\n   */\r\n  previousHash: string;\r\n  /**\r\n   * Computed from the data, timestamp, previous block's hash and nonce. Any of those change, and the hash changes.\r\n   */\r\n  hash: string;\r\n  /**\r\n   * Time of block creation\r\n   */\r\n  timestamp: number;\r\n  /**\r\n   * Arbitrary data. In a cryptocurrency, this will hold the transactions encoded in the block\r\n   */\r\n  data: T;\r\n  /**\r\n   * A random number included at the end of the content for hash calculation, that resulted in the block passing the difficulty test\r\n   */\r\n  nonce: number\r\n}\r\n\r\n/**\r\n * A linked list of blocks\r\n */\r\nexport type Chain<T> = Block<T>[];\r\n\r\n/**\r\n * Get the string from a block the hash is calculated from\r\n */\r\nexport function getHashBase<T>({\r\n  previousHash,\r\n  timestamp,\r\n  data,\r\n  nonce\r\n}: Block<T>, dataSerializer: (data: T) => string): string {\r\n  return previousHash + timestamp + dataSerializer(data) + nonce;\r\n}\r\n\r\n/**\r\n * Calculate a block's hash based on all its other information, ensuring that you can't change the contents of the block without the hash changing\r\n * Uses sha256\r\n */\r\nexport function calculateBlockHash<T>(block: Block<T>, dataSerializer: (data: T) => string): string {\r\n  return getHash(getHashBase(block, dataSerializer));\r\n}\r\n\r\n/**\r\n * Update a block with its calculated hash and return the resulting block.\r\n * When you create a block, you should leave the hash empty and call this function.\r\n */\r\nexport function updateHash<T>(block: Block<T>, dataSerializer: (data: T) => string): Block<T> {\r\n  return { ...block, hash: calculateBlockHash(block, dataSerializer) };\r\n}\r\n\r\n/**\r\n * Update the block with a new once and corresponding hash, and return the resulting block\r\n */\r\nexport function nextNonce<T>(block: Block<T>, dataSerializer: (data: T) => string): Block<T> {\r\n  return updateHash({ ...block, nonce: block.nonce + 1 }, dataSerializer)\r\n}\r\n\r\n/**\r\n * Check whether a sha256 hash matches a given difficulty, meaning whether it starts with difficulty number of 0s\r\n */\r\nexport function checkDifficulty(difficulty: number, hash: string): boolean {\r\n  return hash.substr(0, difficulty) === \"0\".repeat(difficulty)\r\n}\r\n\r\n/**\r\n * Change the nonce property of a block until the resulting hash passes the given difficulty\r\n */\r\nexport function mineBlock<T>(difficulty: number, block: Block<T>, dataSerializer: (data: T) => string) {\r\n  let finishedBlock = block;\r\n  while (!checkDifficulty(difficulty, finishedBlock.hash)) {\r\n    finishedBlock = nextNonce(finishedBlock, dataSerializer);\r\n    console.log(finishedBlock.nonce, finishedBlock.hash);\r\n  }\r\n  return finishedBlock;\r\n}\r\n\r\n/**\r\n * Helper for creating a block with a calculated hash\r\n */\r\nexport function createBlock<T>(data: T, previousHash: string, dataSerializer: (data: T) => string): Block<T> {\r\n  return updateHash({\r\n    timestamp: Date.now(),\r\n    data,\r\n    previousHash,\r\n    hash: '',\r\n    nonce: 0\r\n  }, dataSerializer);\r\n}\r\n\r\n/**\r\n * Validates a chain, ensuring that all blocks' hash are correct and they chain together\r\n */\r\nexport function validateChain<T>(chain: Chain<T>, dataSerializer: (data: T) => string) {\r\n  return chain.map((block, i) => {\r\n    // Genesis block is always valid\r\n    if (i === 0) {\r\n      return true;\r\n    }\r\n    // Validate the block\r\n    if (block.hash !== calculateBlockHash(block, dataSerializer)) {\r\n      console.log(getHashBase(block, dataSerializer));\r\n    }\r\n    return (\r\n      block.hash === calculateBlockHash(block, dataSerializer) && // block hash checks out\r\n      block.previousHash === chain[i -1].hash // previousHash is the save as previous block's hash\r\n    );\r\n  }).filter(isValid => !isValid).length === 0;\r\n}\r\n\r\n/**\r\n * The number of blocks after which we recheck the difficulty\r\n */\r\nexport const DIFFICULTY_CHECK_INTERVAL = 10;\r\n\r\nexport const MINUTE = 1000 * 60;\r\nexport const HOUR = 60 * MINUTE;\r\n\r\n/**\r\n * Expected time for a block to be mined\r\n */\r\nexport const DIFFICULTY_EXPECTED_MINING_TIME = 20 * MINUTE;\r\n\r\n/**\r\n * If the average mining time was lower or larger by this amount than the expected, don't update the difficulty\r\n */\r\nexport const DIFFICULTY_ALLOWED_DIFFERENCE_MULTIPLIER = 0.2;\r\n\r\n/**\r\n * The starting difficulty for an empty chain\r\n */\r\nexport const DIFFICULTY_STARTING = 6;\r\n\r\nexport const DIFFICULTY_MIN = 5;\r\nexport const DIFFICULTY_MAX = 15;\r\n\r\n/**\r\n * A timeperiod after which the difficulty to mine will be the minimum difficulty\r\n */\r\nexport const DIFFICULTY_INACTIVITY_PERIOD = 3 * DIFFICULTY_EXPECTED_MINING_TIME;\r\n\r\n/**\r\n * Gets required difficulty at the end of a given timestamp array. For testability purposes\r\n */\r\nexport function getDifficultyForNextBlockFromTimestamps(timestamps: number[], now: number): number {\r\n  if (now > timestamps[timestamps.length - 1] + DIFFICULTY_INACTIVITY_PERIOD) {\r\n    return DIFFICULTY_MIN;\r\n  }\r\n  // Split the array into equal length chunks\r\n  const chunks = chunk(timestamps, DIFFICULTY_CHECK_INTERVAL);\r\n  return chunks.reduce<number>((difficulty, currentChunk) => {\r\n    // Only change difficulty for full chunks - ignore the last, incomplete chunk\r\n    if (currentChunk.length < DIFFICULTY_CHECK_INTERVAL) {\r\n      return difficulty;\r\n    }\r\n    // Calculate averate mining time\r\n    const averageMiningTime = averageDifference(currentChunk);\r\n    if (averageMiningTime > DIFFICULTY_EXPECTED_MINING_TIME * (1 + DIFFICULTY_ALLOWED_DIFFERENCE_MULTIPLIER)) {\r\n      return Math.min(difficulty - 1, DIFFICULTY_MAX);\r\n    }\r\n\r\n    if (averageMiningTime < DIFFICULTY_EXPECTED_MINING_TIME * (1 - DIFFICULTY_ALLOWED_DIFFERENCE_MULTIPLIER)) {\r\n      return Math.max(difficulty + 1, DIFFICULTY_MIN);\r\n    }\r\n\r\n    return difficulty;\r\n  }, DIFFICULTY_STARTING);\r\n}\r\n\r\n/**\r\n * Gets the required difficulty at the end of a given chain\r\n */\r\nexport function getDifficultyForNextBlock<T>(chain: Block<T>[]): number {\r\n  return getDifficultyForNextBlockFromTimestamps(chain.map(block => block.timestamp), Date.now());\r\n}","import { getHash, toHexString } from \"./util\";\r\nimport * as ecdsa from 'elliptic';\r\nimport { Chain, createBlock } from \"./block\";\r\n\r\nconst ec = new ecdsa.ec('secp256k1');\r\n\r\n/**\r\n * Amount of coins rewarded for the miner of the block\r\n */\r\nexport const REWARD_AMOUNT = 10;\r\n\r\n/**\r\n * Max characters length of the transaction message\r\n */\r\nexport const TRANSACTION_MESSAGE_MAX_LENGTH = 130;\r\n\r\nexport type TransactionOutput = {\r\n  /**\r\n   * This is the public key of the user the number of coins are sent to\r\n   */\r\n  address: string;\r\n  /**\r\n   * Number of coins to send\r\n   */\r\n  amount: number;\r\n}\r\n\r\n/**\r\n * This is a utility type to hold information needed when handling unspent transaction outputs. Otherwise the entire transaction would need to be passed around.\r\n */\r\nexport type UnspentTransactionOutput = {\r\n  /**\r\n   * Id of the transaction this output belongs to\r\n   */\r\n  transactionId: string;\r\n  /**\r\n   * Index of the output inside the transaction outputs. Needed because one transaction can have multiple outputs, and we need to find the corresponding output when we verify\r\n   */\r\n  index: number;\r\n  /**\r\n   * Public key of recipient. Copied from the output directly.\r\n   */\r\n  address: string;\r\n  /**\r\n   * Amount of coins sent. Copied from the output directly.\r\n   */\r\n  amount: number;\r\n}\r\n\r\nexport type TransactionInput = {\r\n\r\n  /**\r\n   * The sender must sign this input with their private key\r\n   * Q: why is not the whole transaction signed instead of the individual inputs, since we use the transaction id as the content for the signature anyway?\r\n   */\r\n  signature: string;\r\n  /**\r\n   * The id of the transaction that holds the unspent output this input is referencing.\r\n   */\r\n  transactionId: string;\r\n  /**\r\n   * Since one transaction can have a number of outputs, we need to know the index of the output inside that transaction this input is referencing\r\n   */\r\n  transactionOutputIndex: number;\r\n}\r\n\r\nexport type Transaction = {\r\n  /**\r\n   * Derived from all other fields of the transaction, excluding signatures. When the data changes, the id should change.\r\n   */\r\n  id: string;\r\n  /**\r\n   * References to unspent outputs belonging to the user\r\n   */\r\n  inputs: TransactionInput[];\r\n  /**\r\n   * All outputs must add up to the total value of all inputs. If there is some leftover, an output should be added that sends the leftover back to the sender.\r\n   */\r\n  outputs: TransactionOutput[];\r\n  /**\r\n   * Optional message to be included with the transaction\r\n   */\r\n  message: string;\r\n}\r\n\r\n/**\r\n * Serialize a transaction, so that the hash function always works with the same input\r\n */\r\nexport function transactionSerializer(transaction: Transaction): string {\r\n  const inputs = transaction.inputs.map(input => input.signature + input.transactionId + input.transactionOutputIndex).join(',');\r\n  const outputs = transaction.outputs.map(output => output.address + output.amount).join(',');\r\n  return transaction.id + inputs + outputs + transaction.message;\r\n}\r\n\r\n/**\r\n * Data serializer for this cryptocurrency\r\n */\r\nexport function dataSerializer(data: Transaction[]): string {\r\n  return data.map(transactionSerializer).join(';');\r\n}\r\n\r\n/**\r\n * Generate a has from the transaction's inputs and outputs to use as the id of the transaction\r\n */\r\nexport function generateTransactionID(transaction: Transaction): string {\r\n  const content = transaction.inputs.map(input => input.transactionId + input.transactionOutputIndex).join('') +\r\n    transaction.outputs.map(output => output.address + output.amount).join('') +\r\n    (transaction.message || '');\r\n  return getHash(content);\r\n}\r\n\r\n/**\r\n * Using your private key, sign a transaction's inputs\r\n */\r\nexport function signTransactionInputs(transaction: Transaction, secretKey: string): Transaction {\r\n  const key = ec.keyFromPrivate(secretKey, 'hex');\r\n  return ({\r\n    ...transaction,\r\n    inputs: transaction.inputs.map(input => {\r\n      return {\r\n        ...input,\r\n        signature: toHexString(key.sign(transaction.id).toDER())\r\n      };\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * Using your private key, sign a transaction's inputs and generate its id\r\n */\r\nexport function signTransaction(transaction: Transaction, secretKey: string): Transaction {\r\n  return signTransactionInputs({\r\n    ...transaction,\r\n    id: generateTransactionID(transaction)\r\n  }, secretKey);\r\n}\r\n\r\n/**\r\n * For a given address, searches the wallet's unspent transaction outputs until it finds enough to fulfill a requestesd amount\r\n */\r\nexport function findUnspentOutputsForAmount(myUnspentTransactionOutputs: UnspentTransactionOutput[], requestedAmount: number): { includedOutputs: UnspentTransactionOutput[], leftoverAmount: number } {\r\n  let currentAmount = 0;\r\n  const includedOutputs = [];\r\n  for (let i = 0; i < myUnspentTransactionOutputs.length; i++) {\r\n    currentAmount += myUnspentTransactionOutputs[i].amount;\r\n    includedOutputs.push(myUnspentTransactionOutputs[i]);\r\n    if (currentAmount >= requestedAmount) {\r\n      return {\r\n        includedOutputs,\r\n        leftoverAmount: currentAmount - requestedAmount\r\n      };\r\n    }\r\n  }\r\n  throw new Error('Requested more outputs than available coins');\r\n}\r\n\r\n/**\r\n * Create an unsigned transaction from start to finish from one address to another\r\n */\r\nexport function createTransactionForAmount(chain: Chain<Transaction[]>, unconfirmedTransactions: Transaction[], myPublicKey: string, targetPublicKey: string, message: string, amount: number): Transaction {\r\n  const myUnspentTransactionOutputs = unspentTransactionsOfAddress(chain, unconfirmedTransactions, myPublicKey);\r\n    const { includedOutputs, leftoverAmount } = findUnspentOutputsForAmount(myUnspentTransactionOutputs, amount);\r\n    return {\r\n      id: '',\r\n      inputs: includedOutputs.map(output => createUnsignedInputFromUnspentOutput(output)),\r\n      outputs: createOutputs(myPublicKey, targetPublicKey, amount, leftoverAmount),\r\n      message\r\n    }\r\n}\r\n\r\n/**\r\n * Helper for creating a transaction with calculated id, and signed\r\n */\r\nexport function createTransaction(inputs: TransactionInput[], outputs: TransactionOutput[], message: string, secretKey: string): Transaction {\r\n  let transaction = {\r\n    id: '',\r\n    inputs,\r\n    message,\r\n    outputs\r\n  };\r\n  transaction = {\r\n    ...transaction,\r\n    id: generateTransactionID(transaction)\r\n  };\r\n  return signTransactionInputs(transaction, secretKey);\r\n}\r\n\r\n/**\r\n * Helper for creating a coinbase transaction\r\n */\r\nexport function createCoinbaseTransaction(blockHeight: number, publicKey: string, secretKey: string): Transaction {\r\n  return createTransaction([{\r\n    signature: '',\r\n    transactionId: '',\r\n    transactionOutputIndex: blockHeight\r\n  }], [{\r\n    address: publicKey,\r\n    amount: blockHeight === 1 ? 500 : REWARD_AMOUNT\r\n  }], 'Coinbase transaction', secretKey);\r\n}\r\n\r\n/**\r\n * Validate transaction outputs\r\n */\r\nexport function validateOutput(output: TransactionOutput): Error | null {\r\n\r\n  // Validate output address\r\n  if (typeof output.address !== 'string') {\r\n    throw new Error('Output address needs to be a valid address');\r\n  }\r\n\r\n  // Validate that no outputs are for 0 amount\r\n  if (output.amount === 0) {\r\n    throw new Error('Can\\'t create output for 0');\r\n  }\r\n\r\n  // Validate that no outputs are for negative amount\r\n  if (output.amount < 0) {\r\n    throw new Error('Can\\'t create output for negative amount');\r\n  }\r\n\r\n  // Validate that no outputs are for more than javascript's safe integer\r\n  if (output.amount > Number.MAX_SAFE_INTEGER) {\r\n    throw new Error(`Can\\'t create output for more than ${Number.MAX_SAFE_INTEGER}`);\r\n  }\r\n\r\n  // Validate that no fraction outputs have a greater precision than allowed\r\n  if (!Number.isInteger(output.amount)) {\r\n    throw new Error(`Only whole coins can be sent`);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Determines whether a transaction is valid or not, checking id and that the inputs are valid, and that inputs equal outputs\r\n */\r\nexport function validateTransaction(transaction: Transaction, myUnspentTransactionOutputs: UnspentTransactionOutput[], unconfirmedTransactions: Transaction[]): boolean {\r\n  // Validate id\r\n  if (generateTransactionID(transaction) !== transaction.id) {\r\n    throw new Error('Transaction ID incorrect');\r\n  }\r\n\r\n  // Validate that the transaction doesn't reference an input that has already been referenced by another unconfirmed transaction\r\n  const allExistingInputs = unconfirmedTransactions.reduce<TransactionInput[]>((arr, transaction) => [...arr, ...transaction.inputs], []);\r\n  const referencesLockedTransaction = transaction.inputs.find(newInput => allExistingInputs.find(existingInput => existingInput.transactionId === newInput.transactionId && existingInput.transactionOutputIndex == newInput.transactionOutputIndex));\r\n  if (referencesLockedTransaction) {\r\n    throw new Error('Transaction references an output already used by another unconfirmed transaction');\r\n  }\r\n\r\n  // Validate that all inputs are unspent and belong to the user\r\n  const allInputsValid = transaction.inputs.map(input => {\r\n    const referencedOutput = myUnspentTransactionOutputs.find(unspentOutput => unspentOutput.transactionId === input.transactionId && unspentOutput.index === input.transactionOutputIndex);\r\n    if (!referencedOutput) {\r\n      console.error('Referenced output doesn\\'t exist');\r\n      return false;\r\n    }\r\n    const address = referencedOutput.address;\r\n    const key = ec.keyFromPublic(address, 'hex');\r\n    return key.verify(transaction.id, input.signature);\r\n  }).filter(Boolean).length === transaction.inputs.length;\r\n\r\n  if (!allInputsValid) {\r\n    throw new Error('Not all inputs are valid for transaction.')\r\n  }\r\n\r\n  // Check that all inputs equal outputs\r\n  const inputValue = transaction.inputs.reduce((acc, input) => {\r\n    const referencedOutput = myUnspentTransactionOutputs.find(unspentOutput => unspentOutput.transactionId === input.transactionId && unspentOutput.index === input.transactionOutputIndex);\r\n    if (!referencedOutput) {\r\n      return 0;\r\n    }\r\n    return acc + referencedOutput.amount;\r\n  }, 0);\r\n  const outputValue = transaction.outputs.reduce((acc, output) => acc + output.amount, 0);\r\n  if (inputValue !== outputValue) {\r\n    throw new Error('Input and output values do not match in transaction.');\r\n  }\r\n\r\n  // Validate outputs\r\n  transaction.outputs.forEach(output => validateOutput(output));\r\n\r\n  // Validate that the transaction message is valid type\r\n  if (typeof transaction.message !== 'string') {\r\n    throw new Error('Invalid message type');\r\n  }\r\n\r\n  // Validate that the transaction message is valid if exists\r\n  if (transaction.message.length > TRANSACTION_MESSAGE_MAX_LENGTH) {\r\n    throw new Error(`Message exceeds ${TRANSACTION_MESSAGE_MAX_LENGTH} chacracters`);\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Coinbase transactions are always the first transactions in a block, and they reward the miner of the block with REWARD_AMOUNT\r\n * Checking its validity is different. The input's index is the block's index.\r\n * Q: Why does this have to have any inputs anyway? Maybe because the need to sign it? Would someone be able to steal an output otherwise?\r\n * Right now I'm just going to ignore the input and only have an output, before I understand this.\r\n */\r\nexport function validateCoinbaseTransaction(transaction: Transaction, blockHeight: number) {\r\n  // Validate id\r\n  const generatedId = generateTransactionID(transaction);\r\n  if (generatedId !== transaction.id) {\r\n    throw new Error('Transaction ID incorrect.')\r\n  }\r\n\r\n  if (transaction.inputs.length !== 1) {\r\n    throw new Error('Coinbase transaction can only have one input.');\r\n  }\r\n\r\n  if (transaction.inputs[0].transactionOutputIndex !== blockHeight) {\r\n    throw new Error('Coinbase transaction\\'s input must contain blockHeight as the output index.');\r\n  }\r\n\r\n  if (transaction.outputs.length !== 1) {\r\n    throw new Error('Coinbase transaction can only have one output.');\r\n  }\r\n\r\n  const correctRewardAmount = blockHeight === 1 ? 500 : REWARD_AMOUNT;\r\n\r\n  if (transaction.outputs[0].amount !== correctRewardAmount) {\r\n    throw new Error('Coinbase transaction value must be for ' + correctRewardAmount);\r\n  }\r\n\r\n  if (transaction.message !== 'Coinbase transaction') {\r\n    throw new Error('Coinbase transaction can\\'t include a custom message');\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Helper for converting a transaction's outputs into unspent transactions\r\n */\r\nexport function createUnspentTransactionOutputs(transaction: Transaction): UnspentTransactionOutput[] {\r\n  return transaction.outputs.map((output, index) => ({\r\n    transactionId: transaction.id,\r\n    index,\r\n    address: output.address,\r\n    amount: output.amount\r\n  }));\r\n}\r\n\r\n/**\r\n * Calculate all unspent transactions at the end of a blockchain, regardless of target address\r\n */\r\nexport function calculateUnspentOutputs(chain: Chain<Transaction[]>, unconfirmedTransactions: Transaction[]): UnspentTransactionOutput[] {\r\n  const chainWithUnconfirmed = [...chain, createBlock(unconfirmedTransactions, chain[chain.length - 1].hash, dataSerializer)];\r\n  // TODO: I think there is a bug now when the input references a transaction in the same block\r\n  return chainWithUnconfirmed.reduce<UnspentTransactionOutput[]>((unspentTransactions, block) => {\r\n    // Gather all new outputs on this block\r\n    const newUnspentOutputs = block.data.reduce<UnspentTransactionOutput[]>((acc, transaction) => acc.concat(createUnspentTransactionOutputs(transaction)), []);\r\n    // Gather all inputs on this block, so we can use them to unvalidate older outputs\r\n    const allInputsOnThisBlock = block.data.reduce<TransactionInput[]>((acc, transaction) => acc.concat(transaction.inputs), []);\r\n    // Invalidate outputs based on these new inputs\r\n    const remainingUnspentTransactions: UnspentTransactionOutput[] = [...unspentTransactions, ...newUnspentOutputs].filter(unspentTransaction => {\r\n      // Remove unspenttransaction if the current block references it as an input\r\n      if (allInputsOnThisBlock.find(input => input.transactionId === unspentTransaction.transactionId && input.transactionOutputIndex === unspentTransaction.index)) {\r\n        return false;\r\n      }\r\n      return true;\r\n    });\r\n    return remainingUnspentTransactions\r\n  }, []);\r\n}\r\n\r\n/**\r\n * Get all unspent transactions of a single user\r\n */\r\nexport function unspentTransactionsOfAddress(chain: Chain<Transaction[]>, unconfirmedTransactions: Transaction[], address: string): UnspentTransactionOutput[] {\r\n  const allUnspentTransactions = calculateUnspentOutputs(chain, unconfirmedTransactions);\r\n  return allUnspentTransactions.filter(transaction => transaction.address === address);\r\n}\r\n\r\n/**\r\n * Get remaining coins of a single user\r\n */\r\nexport function balanceOfAddress(chain: Chain<Transaction[]>, unconfirmedTransactions: Transaction[], address: string): number {\r\n  const unspentTransactions = unspentTransactionsOfAddress(chain, unconfirmedTransactions, address);\r\n  return unspentTransactions.reduce((acc, transaction) => acc + transaction.amount, 0);\r\n}\r\n\r\n/**\r\n * Helper for creating an input from an unspent output\r\n */\r\nexport function createUnsignedInputFromUnspentOutput(output: UnspentTransactionOutput): TransactionInput {\r\n  return {\r\n    signature: '',\r\n    transactionId: output.transactionId,\r\n    transactionOutputIndex: output.index,\r\n  };\r\n}\r\n\r\n/**\r\n * Helper for creating a one way transaction output\r\n */\r\nexport function createOutputs(myPublicKey: string, receiverPublicKey: string, amount: number, leftoverAmount: number): TransactionOutput[] {\r\n  if (leftoverAmount > 0) {\r\n    return [{\r\n      address: receiverPublicKey,\r\n      amount\r\n    }, {\r\n      address: myPublicKey,\r\n      amount: leftoverAmount\r\n    }];\r\n  }\r\n\r\n  return [{\r\n    address: receiverPublicKey,\r\n    amount\r\n  }];\r\n}\r\n\r\n/**\r\n * Find the sender's address based on the inputs of the transaction\r\n */\r\nexport function getSenderAddress(transaction: Transaction, chain: Chain<Transaction[]>): string | null {\r\n  const sampleInput = transaction.inputs[0];\r\n  if (!sampleInput.transactionId) {\r\n    return null;\r\n  }\r\n  const outputTransactionBlock = chain.find(block => block.data.find(transaction => transaction.id === sampleInput.transactionId));\r\n  const outputTransaction = outputTransactionBlock?.data.find(transaction => transaction.id === sampleInput.transactionId);\r\n  const output = outputTransaction?.outputs[sampleInput.transactionOutputIndex];\r\n  return output?.address || null;\r\n}\r\n\r\n/**\r\n * Get all transactions an address was involved in\r\n */\r\nexport function getTransactionsOfAddress(chain: Chain<Transaction[]>, unconfirmedTransactions: Transaction[], address: string): Transaction[] {\r\n  const transactions = chain.reduce<Transaction[]>((acc, block) => acc.concat(block.data), []).concat(unconfirmedTransactions);\r\n  console.log(transactions);\r\n  return transactions.filter(transaction => {\r\n    return transaction.outputs.find(output => output.address === address) || getSenderAddress(transaction, chain) === address\r\n  });\r\n}","import { Card, CardContent, Divider, makeStyles, Typography } from '@material-ui/core';\r\nimport React, { useContext } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { getSenderAddress, Transaction } from '../../../src/transaction';\r\nimport { DataContext } from './DataProvider';\r\n\r\ntype Props = {\r\n  transaction: Transaction;\r\n}\r\n\r\nconst useStyles = makeStyles({\r\n  hash: {\r\n    fontSize: 12\r\n  }\r\n});\r\n\r\nexport function shortAddress(hash: string): string {\r\n  return `${hash.substr(0, 8)}...${hash.substr(-8)}`;\r\n}\r\n\r\nexport default function TransactionComponent({ transaction }: Props) {\r\n  const classes = useStyles();\r\n  const { chain } = useContext(DataContext);\r\n\r\n  const sender = getSenderAddress(transaction, chain);\r\n\r\n  const senderDisplay = sender ? <Link to={`/wallet/${sender}`}>{shortAddress(sender)}</Link> : <strong>COINBASE</strong>\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <CardContent>\r\n          <Typography color=\"textSecondary\" className={classes.hash}>{transaction.id}</Typography>\r\n          <Typography>\r\n            {transaction.outputs.map((output, i) => (\r\n              <div key={i}>\r\n                {senderDisplay} &gt; <Link to={`/wallet/${output.address}`}>{shortAddress(output.address)}</Link> for <strong>{output.amount}</strong> coins\r\n              </div>\r\n            ))}\r\n          </Typography>\r\n          {transaction.message && (\r\n            <Typography>\r\n              Included message: \"{transaction.message}\"\r\n            </Typography>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n      <Divider />\r\n    </>\r\n  )\r\n}","import { makeStyles, Card, CardContent, Accordion, AccordionSummary, AccordionDetails, Grid } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { Block } from '../../../src/block';\r\nimport { Transaction } from '../../../src/transaction';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport TransactionComponent from './Transaction';\r\n\r\ntype Props = {\r\n  block: Block<Transaction[]>;\r\n  index: number;\r\n}\r\n\r\nconst useStyles = makeStyles({\r\n  hash: {\r\n    fontSize: 12\r\n  }\r\n});\r\n\r\nconst difficultyRegex = /^0+/;\r\n\r\nexport default function BlockComponent({ block, index }: Props) {\r\n  const classes = useStyles();\r\n  const difficulty = difficultyRegex.exec(block.hash);\r\n  return (\r\n    <Card>\r\n      <CardContent>\r\n        <Typography component=\"h2\" variant=\"h6\" color=\"textSecondary\" gutterBottom>\r\n          Block {index}\r\n        </Typography>\r\n        <Typography color=\"textSecondary\" className={classes.hash}>\r\n          {block.hash}\r\n        </Typography>\r\n        <Typography color=\"textSecondary\" className={classes.hash} gutterBottom>\r\n          Difficulty: {difficulty ? difficulty[0].length : 0}\r\n        </Typography>\r\n        <Typography color=\"textSecondary\" className={classes.hash} gutterBottom>\r\n          {new Date(block.timestamp).toLocaleString()}\r\n        </Typography>\r\n\r\n      </CardContent>\r\n        <Accordion>\r\n          <AccordionSummary\r\n            expandIcon={<ExpandMoreIcon />}\r\n            aria-controls=\"panel1a-content\"\r\n            id=\"panel1a-header\"\r\n          >\r\n            <Typography color=\"textSecondary\">{block.data.length} transaction{block.data.length === 1 ? '' : 's'}</Typography>\r\n          </AccordionSummary>\r\n          <AccordionDetails>\r\n              <Grid container spacing={1}>\r\n                {block.data.map(transaction => (\r\n                  <Grid item xs={12} key={transaction.id}>\r\n                    <TransactionComponent  transaction={transaction} />\r\n                  </Grid>\r\n                ))}\r\n              </Grid>\r\n          </AccordionDetails>\r\n        </Accordion>\r\n\r\n    </Card>\r\n  )\r\n}","import { Grid } from \"@material-ui/core\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport BlockComponent from \"./Block\";\r\nimport { DataContext } from \"./DataProvider\";\r\n\r\nexport default function BlockList() {\r\n  const { chain } = useContext(DataContext);\r\n\r\n  const reversedChain = useMemo(() => [...chain].reverse(), [chain]);\r\n\r\n  return (\r\n    <Grid container spacing={2}>\r\n      {reversedChain.map((block, i) => (\r\n        <Grid item lg={6} key={block.hash}>\r\n          <BlockComponent block={block} index={reversedChain.length - i} />\r\n        </Grid>\r\n      ))}\r\n    </Grid>\r\n  )\r\n}","import { Grid, makeStyles, Paper, Table, TableBody, TableCell, TableHead, TableRow, Typography } from \"@material-ui/core\";\r\nimport React, { useContext, useMemo } from \"react\";\r\nimport { useParams } from \"react-router\";\r\nimport { balanceOfAddress, getSenderAddress, getTransactionsOfAddress } from \"../../../src/transaction\";\r\nimport { DataContext } from \"./DataProvider\";\r\nimport { shortAddress } from \"./Transaction\";\r\nimport { Link } from 'react-router-dom';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  paper: {\r\n    padding: theme.spacing(2),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    wordBreak: 'break-all'\r\n  }\r\n}));\r\n\r\n\r\n\r\nexport default function Wallet() {\r\n  const { address } = useParams<{ address: string }>();\r\n  const { chain } = useContext(DataContext);\r\n  const classes = useStyles();\r\n  const balance = chain.length > 0 ? balanceOfAddress(chain, [], address) : null;\r\n  const transactions = useMemo(() => {\r\n    return getTransactionsOfAddress(chain, [], address).reverse();\r\n  }, [address, chain]);\r\n\r\n  return (\r\n    <>\r\n      <Grid container spacing={2}>\r\n        <Grid item xs={12}>\r\n          <Paper className={classes.paper}>\r\n            <Typography component=\"h2\" variant=\"h6\" color=\"primary\" gutterBottom>Wallet {address}</Typography>\r\n            {balance !== null && <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom>Balance: {balance}</Typography>}\r\n            <Table size=\"small\">\r\n              <TableHead>\r\n                <TableRow>\r\n                  <TableCell>Incoming / Outgoing</TableCell>\r\n                  <TableCell>Address</TableCell>\r\n                  <TableCell align=\"right\">Amount</TableCell>\r\n                  <TableCell>Message</TableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {transactions.map((transaction) => {\r\n                  const isCoinbase = transaction.inputs.length === 1 &&\r\n                    transaction.outputs.length === 1 &&\r\n                    Number.isInteger(transaction.inputs[0].transactionOutputIndex) &&\r\n                    transaction.inputs[0].transactionId === '';\r\n                  const isSendingToYourself = !isCoinbase && !transaction.outputs.map(o => o.address).find(a => a !== address);\r\n                  if (isSendingToYourself) {\r\n                    return null;\r\n                  }\r\n                  const senderAddress = getSenderAddress(transaction, chain);\r\n                  const isOutgoing = senderAddress === address;\r\n                  const relevantOutput = isOutgoing ?\r\n                    transaction.outputs.find(output => output.address !== address) :\r\n                    transaction.outputs.find(output => output.address === address);\r\n                  const otherAddress = isOutgoing ? relevantOutput?.address : senderAddress;\r\n                  const otherAddressDisplay = otherAddress ? <Link to={`/wallet/${otherAddress}`}>{shortAddress(otherAddress)}</Link> : (isCoinbase ? 'COINBASE' : '-');\r\n                  return (\r\n                    <TableRow key={transaction.id}>\r\n                      <TableCell>{isOutgoing ? 'Outgoing' : 'Incoming'}</TableCell>\r\n                      <TableCell>{otherAddressDisplay}</TableCell>\r\n                      <TableCell align=\"right\">{otherAddress ? relevantOutput?.amount : transaction.outputs[0].amount}</TableCell>\r\n                      <TableCell>{transaction.message}</TableCell>\r\n                    </TableRow>\r\n                  );\r\n                })}\r\n              </TableBody>\r\n            </Table>\r\n          </Paper>\r\n        </Grid>\r\n      </Grid>\r\n    </>\r\n  )\r\n}","import { Grid, makeStyles, Paper, TextField, Typography } from \"@material-ui/core\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  paper: {\r\n    padding: theme.spacing(2),\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    wordBreak: 'break-all'\r\n  }\r\n}));\r\n\r\n\r\nexport default function MyWallet() {\r\n  const classes = useStyles();\r\n  const [publicKey, setPublicKey] = useState(localStorage.getItem('publicKey') || '');\r\n  const [secret, setSecret] = useState(localStorage.getItem('secret') || '');\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('publicKey', publicKey);\r\n    localStorage.setItem('secret', secret);\r\n  }, [publicKey, secret]);\r\n\r\n  return (\r\n    <Grid container spacing={2}>\r\n      <Grid item xs={12}>\r\n        <Paper className={classes.paper}>\r\n          <Typography component=\"h2\" variant=\"h6\" color=\"primary\" gutterBottom>My Wallet</Typography>\r\n          <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom>Set your wallet details</Typography>\r\n          <TextField label=\"Public key\" variant=\"outlined\" value={publicKey} onChange={(event: React.ChangeEvent<HTMLInputElement>) => setPublicKey(event.target.value)} margin=\"normal\" />\r\n          <TextField label=\"Secret key\" variant=\"outlined\" value={secret} onChange={(event: React.ChangeEvent<HTMLInputElement>) => setSecret(event.target.value)} margin=\"normal\" />\r\n          {publicKey && <Link to={`/wallet/${publicKey}`}>Go to wallet</Link>}\r\n        </Paper>\r\n      </Grid>\r\n    </Grid>\r\n  )\r\n}","const ROOT = 'http://hyggecoin.herokuapp.com';\n\nexport default function getJson<T>(path: string): Promise<T> {\n  return fetch(ROOT + path, {\n    mode: 'cors',\n    credentials: 'omit'\n  })\n    .then(response => response.json())\n    .then(response => (response.data))\n    .catch(err => console.error(err));\n}\n\nexport function post(path: string, body: any) {\n  return fetch(ROOT + path, {\n    method: 'POST',\n    body: JSON.stringify(body),\n    mode: 'cors',\n    credentials: 'omit',\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  })\n  .then(res => res.json())\n  .then(res => res.data)\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/miner.worker.f387f6d7.worker.js\");\n}\n","import { FormControl, Grid, makeStyles, MenuItem, Paper, Select, Typography } from \"@material-ui/core\";\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from \"react\";\nimport { post } from \"../utils/getJson\";\nimport { Block, createBlock, getDifficultyForNextBlock } from \"../../../src/block\";\nimport { createCoinbaseTransaction, dataSerializer, Transaction } from \"../../../src/transaction\";\nimport { DataContext } from \"./DataProvider\";\n// eslint-disable-next-line import/no-webpack-loader-syntax\nimport Miner from 'worker-loader!./miner.worker';\nimport { WorkerEvent } from \"./miner.worker\";\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'column',\n    wordBreak: 'break-all'\n  },\n  text: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  select: {\n    marginLeft: '1em'\n  }\n}));\n\nexport default function BlockList() {\n  const { chain, unconfirmedTransactions } = useContext(DataContext);\n  const classes = useStyles();\n  const publicKey = localStorage.getItem('publicKey');\n  const secretKey = localStorage.getItem('secret');\n  const [hashCount, setHashCount] = useState(0);\n  const [block, setBlock] = useState<Block<Transaction[]> | null>(null);\n  const [solutions, setSolutions] = useState(0);\n  const [cores, setCores] = useState(1);\n  const workers = useRef<Worker[] | null>(null);\n  const progressInfo = useRef<Array<{ timestamp: number; count: number; }>>([]);\n\n  const data = useMemo(() => {\n    if (!unconfirmedTransactions || chain.length === 0 || !secretKey || !publicKey) {\n      return null;\n    }\n    const coinbaseTransaction = createCoinbaseTransaction(chain.length, publicKey, secretKey);\n    const unminedBlock = createBlock([coinbaseTransaction, ...unconfirmedTransactions], chain[chain.length - 1].hash, dataSerializer);\n    const difficulty = getDifficultyForNextBlock(chain);\n\n    return {\n      chain,\n      unconfirmedTransactions,\n      coinbaseTransaction,\n      unminedBlock,\n      difficulty\n    }\n  }, [chain, unconfirmedTransactions, publicKey, secretKey]);\n\n  /**\n   * Update internal values / get the mined block when events are sent from workers\n   */\n  const onWorkerEvent = useCallback((event: MessageEvent<WorkerEvent>) => {\n    const workerEvent = event.data;\n    if (workerEvent.type === 'count') {\n      setHashCount(count => count + workerEvent.count);\n    } else if (workerEvent.type === 'solution') {\n      console.log(workerEvent.block)\n      setBlock(workerEvent.block);\n    }\n  }, []);\n\n  /**\n   * Setup / reset miners when new data is available\n   */\n  useEffect(() => {\n    if (data?.unminedBlock && data?.difficulty && !block) {\n      const newWorkers = []\n      for (let i = 0; i < cores; i++) {\n        const miner = new Miner();\n        miner.postMessage({\n          unminedBlock: data.unminedBlock,\n          difficulty: data.difficulty\n        });\n        miner.onmessage = onWorkerEvent;\n        newWorkers.push(miner);\n      }\n      workers.current = newWorkers;\n    }\n    return () => {\n      if (workers.current) {\n        console.log('terminating all workers');\n        workers.current.forEach(worker => worker.terminate());\n      }\n    }\n  }, [data, onWorkerEvent, block, cores]);\n\n  /**\n   * Send a mined block when ready to the server and reset state\n   */\n  useEffect(() => {\n    if (block) {\n      post('/mine-block', block).then((res) => {\n        if (res === 'success') {\n          setSolutions(solutions => solutions + 1);\n        }\n        setHashCount(0);\n        setBlock(null);\n        progressInfo.current = []\n      })\n      .catch(err => {\n        console.log(err);\n        setHashCount(0);\n        setBlock(null);\n        progressInfo.current = []\n      });\n    }\n  }, [block]);\n\n  const handleCoresChange = useCallback((event: React.ChangeEvent<{ name?: string | undefined; value: unknown }>) => {\n    setCores(event.target.value as number);\n  }, [])\n\n  /**\n   * Update the progressinfo array with the latest count, so we can calculate a rolling average of hashes / s\n   */\n  useEffect(() => {\n    progressInfo.current = [...progressInfo.current, { timestamp: Date.now(), count: hashCount }];\n    if (progressInfo.current.length > 200) {\n      progressInfo.current = progressInfo.current.slice(-200);\n    }\n  }, [hashCount]);\n\n  if (!unconfirmedTransactions) {\n    return <>Loading...</>\n  }\n\n  if (!secretKey || !publicKey) {\n    return <>Please specify your public and secret keys in your Wallet</>;\n  }\n\n  /**\n   * Calculate a rolling average of the hashrate\n   */\n  const hashRate = progressInfo.current.length >= 2 ?\n    (progressInfo.current[progressInfo.current.length - 1].count - progressInfo.current[0].count) / ((progressInfo.current[progressInfo.current.length - 1].timestamp - progressInfo.current[0].timestamp) / 1000) :\n    null;\n\n  return (\n    <Grid container spacing={2}>\n        <Grid item xs={12}>\n          <Paper className={classes.paper}>\n            <Typography component=\"h2\" variant=\"h6\" color=\"primary\" gutterBottom>Mine block</Typography>\n            <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom>Block will include {unconfirmedTransactions.length} transactions</Typography>\n            {data?.difficulty && <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom>Difficulty: {data.difficulty}</Typography>}\n            <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom className={classes.text}>Number of cores used <FormControl variant=\"outlined\">\n              <Select\n                labelId=\"demo-simple-select-error-label\"\n                id=\"demo-simple-select-error\"\n                value={cores}\n                onChange={handleCoresChange}\n                className={classes.select}\n              >\n                {(new Array(navigator.hardwareConcurrency).fill(true).map((_, i) => i+1)).map(item => {\n                  return <MenuItem value={item} key={item}>{item}</MenuItem>\n                })}\n              </Select>\n            </FormControl></Typography>\n\n            {hashCount > 0 && <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom>Mining in progress, tries: {hashCount}, hash rate: {hashRate && Math.floor(hashRate / 1000)} khashes/s</Typography>}\n            {solutions > 0 && <Typography component=\"h3\" variant=\"h6\" color=\"textSecondary\" gutterBottom>Solutions: {solutions}</Typography>}\n          </Paper>\n        </Grid>\n    </Grid>\n  )\n}","import { Button, Grid, makeStyles, Paper, TextField, Typography } from \"@material-ui/core\";\nimport React, { useCallback, useContext, useMemo, useState } from \"react\";\nimport { post } from \"../utils/getJson\";\nimport { createTransactionForAmount, signTransaction } from \"../../../src/transaction\";\nimport { DataContext } from \"./DataProvider\";\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'column',\n    wordBreak: 'break-all'\n  }\n}));\n\n\nexport default function CreateTransaction() {\n  const classes = useStyles();\n  const { chain, unconfirmedTransactions } = useContext(DataContext);\n  const publicKey = localStorage.getItem('publicKey');\n  const secretKey = localStorage.getItem('secret');\n  const [data, setData] = useState({\n    recipient: '',\n    amount: 0\n  });\n\n  const handleRecipientChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    setData(data => ({\n      ...data,\n      recipient: event.target.value\n    }));\n  }, []);\n\n  const handleAmountChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    setData(data => ({\n      ...data,\n      amount: parseInt(event.target.value)\n    }));\n  }, []);\n\n  const transaction = useMemo(() => {\n    if (!unconfirmedTransactions || chain.length === 0 || !publicKey || !secretKey || !data.recipient || !data.amount) {\n      return null;\n    }\n    const unsignedTransaction = createTransactionForAmount(chain, unconfirmedTransactions, publicKey, data.recipient, '', data.amount);\n    return signTransaction(unsignedTransaction, secretKey);\n  }, [chain, data.amount, data.recipient, publicKey, secretKey, unconfirmedTransactions]);\n\n  const send = useCallback(() => {\n    post('/add-transaction', transaction).then((res) => {\n      if (res === 'success') {\n        setData({\n          recipient: '',\n          amount: 0\n        })\n      }\n    })\n    .catch(err => {\n      console.log(err);\n    });\n  }, [transaction])\n\n  return (\n    <Grid container spacing={2}>\n      <Grid item xs={12}>\n        <Paper className={classes.paper}>\n          <Typography component=\"h2\" variant=\"h6\" color=\"primary\" gutterBottom>Create Transaction</Typography>\n          <TextField label=\"Recipient address\" variant=\"outlined\" value={data.recipient} onChange={handleRecipientChange} margin=\"normal\" />\n          <TextField label=\"Amount\" variant=\"outlined\" value={data.amount} onChange={handleAmountChange} margin=\"normal\" />\n          <Button onClick={send} disabled={!transaction}>Send coins</Button>\n        </Paper>\n      </Grid>\n    </Grid>\n  )\n}","import React from 'react';\r\nimport DataProvider from './components/DataProvider';\r\nimport Layout from './components/Layout';\r\nimport { HashRouter, Switch, Route } from 'react-router-dom';\r\nimport BlockList from './components/BlockList';\r\nimport Wallet from './components/Wallet';\r\nimport MyWallet from './components/MyWallet';\r\nimport Mine from './components/Mine';\r\nimport CreateTransaction from './components/CreateTransaction';\r\n\r\nexport default function App() {\r\n\r\n  return (\r\n    <DataProvider>\r\n      <HashRouter>\r\n        <Layout>\r\n            <Switch>\r\n              <Route path=\"/chain-explorer\">\r\n                <BlockList />\r\n              </Route>\r\n              <Route path=\"/wallet\" exact>\r\n                <MyWallet />\r\n              </Route>\r\n              <Route path=\"/wallet/:address\">\r\n                <Wallet />\r\n              </Route>\r\n              <Route path=\"/create-transaction\">\r\n                <CreateTransaction />\r\n              </Route>\r\n              <Route path=\"/mine\">\r\n                <Mine />\r\n              </Route>\r\n            </Switch>\r\n        </Layout>\r\n      </HashRouter>\r\n    </DataProvider>\r\n  )\r\n}","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render((\r\n  <App />\r\n), document.getElementById('root'));\r\n"],"sourceRoot":""}